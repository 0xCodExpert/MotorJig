/***********************************************************************************************//**
* \file	ring_buffer.c
* \brief
* \author D.aN
* <pre>
* Ver   Date       Changes
* ----- ---------- -----------------------------------------------
* 00.01 2014/02/14 file generated
* </pre>
*
***************************************************************************************************/

/***************************************************************************************************
*	Include Files
***************************************************************************************************/
#include "ring_buffer.h"

/***************************************************************************************************
*	Constant Definitions
***************************************************************************************************/


/***************************************************************************************************
*	Type Definitions
***************************************************************************************************/


/***************************************************************************************************
*	Macros (Inline Functions) Definitions
***************************************************************************************************/


/***************************************************************************************************
*	Variable Definitions
***************************************************************************************************/


/***************************************************************************************************
*	Function Prototypes
***************************************************************************************************/


/***********************************************************************************************//**
* \brief	링 버퍼를 초기화한다.
* \param	b	struct ring_buffer	포인터
* \param	buffer 데이터 버퍼 포인터
* \param	length	데이터 버퍼의 크기(RING_DATA 단위)
* \return
* \note
***************************************************************************************************/
STATUS Ring_Initialize(struct ring_buffer *b, RING_DATA *buffer, INT32U length)
{
//	ASSERT_NONVOID(b != NULL);
//	ASSERT_NONVOID(buffer != NULL);
	
	b->buf		= buffer;
	b->length	= length;
	b->head		= 0;
	b->tail		= 0;
	
	return ST_SUCCESS;
}

/***********************************************************************************************//**
* \brief	버퍼에 저장되어 있는 데이터의 갯수를 확인하는 함수
* \param	b	링 버퍼 포인터
* \return	데이터 갯수
* \note
***************************************************************************************************/
INT16U Ring_GetCount(struct ring_buffer *b)
{
	uint16_t	count;
	
	if(b->head >= b->tail)
	{
		count	= b->head - b->tail;
	}
	else
	{
		count	= b->head + b->length - b->tail;
	}
	
	return count;
}

/***********************************************************************************************//**
* \brief	링 버퍼가 비어있는지 체크한다.
* \param	b	링 버퍼 포인터
* \return	TRUE 또는 FALSE
* \note
***************************************************************************************************/
BOOL Ring_IsEmpty(struct ring_buffer const *b)
{
//	ASSERT_NONVOID(b != NULL);
	
	return (Ring_GetCount((struct ring_buffer *)b) == 0);
}

/***********************************************************************************************//**
* \brief	핑 버퍼가 가득 차있는지 체크한다.
* \param	b	링 버퍼 포인터
* \return	TRUE 또는 FALSE
* \note
***************************************************************************************************/
BOOL Ring_IsFull(struct ring_buffer const *b)
{
//	ASSERT_NONVOID(b != NULL);
	
	return (Ring_GetCount((struct ring_buffer *)b) == (b->length - 1));
}

/***********************************************************************************************//**
* \brief	링 버퍼에 데이터를 추가한다.
* \param	b	링 버퍼 포인터
* \param	data	데이터
* \return	None
* \note
***************************************************************************************************/
void Ring_Put(struct ring_buffer *b, RING_DATA data)
{
//	ASSERT_VOID(b != NULL);
//	ASSERT_VOID(b->buf != NULL);
	
	if(!Ring_IsFull(b))
	{
		b->buf[b->head]	= data;
		b->head	= (b->head + 1) % b->length;	/* 경계 처리 */
	}
	else
	{
//		ERRORF("ring buffer full!\r\n");
	}
}

/***********************************************************************************************//**
* \brief	링 버퍼에서 데이터를 가져온다.
* \param	b	링 버퍼 포인터
* \return	데이터
* \note
***************************************************************************************************/
RING_DATA Ring_Get(struct ring_buffer *b)
{
	RING_DATA	data;
	
//	ASSERT_NONVOID(b != NULL);
//	ASSERT_NONVOID(b->buf != NULL);
	
	if(!Ring_IsEmpty(b))
	{
		data	= b->buf[b->tail];
		b->tail	= (b->tail + 1) % b->length;	/* 경계 처리 */
	}
	else
	{
//		ERRORF("ring buffer empty!\r\n");
		data	= 0;
	}
	
	return data;
}
